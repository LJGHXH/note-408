# 总线

总线是一组能为多个部件分时共享的公共信息传输线路。包含以下特性：

1. 机械特性：尺寸、形状、管脚数、排列顺序
2. 电气特性：传输方向和有效的电平范围
3. 功能特性：每根传输线的功能（地址、数据、控制）
4. 时间特性：信号的时序关系

通过总线进行信号传输，包括地址总线、数据总线、控制总线。

**按数据传输格式分类**：  
串行总线：一条传输线，成本低，广泛应用长距离传输，节省布线空间。但在数据传输和接收、拆卸和装配，要考虑串并行转换的问题。  
并行总线：逻辑是需简单，电路实现容易。但信号线数量多，占用更多布线空间，远距离传输成本高。

**按总线功能分类**：  
片内总线：芯片内部总线。CPU内部的寄存器和寄存器间、寄存器和ALU间的公共连接线。  
系统总线：计算机系统内各功能组件（CPU、主存、IO接口）间相互连接的总线。按传输信息内容的不同，可细分为地址总线、数据总线、控制总线。  
通信总线：用于计算机系统之间或计算机系统与其他系统（远程通信设备、测试设备等）之间信息传送的总线（例如网线），也叫外部总线。

## 系统总线的结构

**单总线结构**：  
各功能组件都接在一组总线。  
结构简单成本低，易于接入新设备；  
但带宽低负载重，多个部件争用唯一总线，不支持并发传送操作。

**双总线结构**：  
两条总线：主存总线（CPU、主存、通道之间进行数据传送）、IO总线（多个外部设备与通道之间进行数据传送）。  
将较低苏IO设备从蛋总线上分离，实现存储器总线和IO总线分离；  
但需要增加通道等硬件设备。

**三总线结构**：  
三条总线：主存总线、IO总线、DMA总线（直接内存访问）。  
提高了IO设备性能，使其更快相应命令，提高系统吞吐量；  
但系统工作效率较低。

四总线结构对于现代计算机中更常用。

## 总线的性能指标

**传输周期（总线周期）**：  
一次总线操作所需时间（申请、寻址、传输、结束），由若干总线时钟周期构成。

**时钟周期**：  
即机器的时钟周期，计算机有一个统一时钟以控制整个计算机各部件，总线也要受此控制。

**工作频率**：  
总线周期的倒数，反映一秒内传送几次数据。

**时钟频率**：  
时钟周期的倒数，反映一秒内时钟周期的数量。

**总线宽度（总线位宽）**：  
总线上能同时传输的数据位数，通常指数据总线的根数（eg 32根称为32位(bit)总线。  

**总线带宽**：  
总线的数据传输率，单位时间内总线上可传输的数据位数，通常用美妙传送信息的字节数来衡量，单位`字节/秒（B/s）`。  
`总线带宽 = 总线工作频率 × 总线宽度 (bit/s) = 总线工作频率 × (总线宽度/8) (B/s)`

*注：总线带宽指总线本身所能达到的最高传输速率，计算实际有效数据传输率时，要用实际传输的数据量除以耗时。*

**总线复用**：  
一种信号线在不同时间传输不同信息，用较少线传输更多信息，节省空间和成本。

**信号线数**：  
地址总线、数据总线、控制总线的线数量总和。

## 总线操作和定时

调度占用总线的一对设备进行数据传输。

总线定时是总线在双方交换数据的过程中需要时间上配合关系的控制，实质是一种协议或规则。包括有：

- **同步通信**（同步定时方式）：由统一时钟控制数据传送
  - 由若干时钟产生若干相等时间间隔并构成一个总线周期，期间发收双方都可进行一次数据传送。一个总线传送周期结束，下一总线传送周期开始。
  - 传送速度快，总控逻辑简单；</br> 但主从设备属于强制性同步，不能及时进行数据通信的有效性检验，可靠性差。
  - 适用于总线长度较短以及总线所接部件存取时间比较接近的系统。
- **异步通信**（异步定时方式）：采用应答方式，没有公共始时钟标准
  - 主设备提出交换信息的“请求”信号，经接口传送到从设备；从设备接到主设备请求后，通过接口向主设备发出“回答”信号。</br> 请求和应答的信号是否互锁会分为以下类型：
    1. 不互锁方式
    2. 半互锁方式
    3. 全互锁方式
  - 总线周期长度可变，保证两个工作速度相差很大的部件间可靠地进行信息交换，自动适应时间的配合；</br> 但比同步控制方式复杂，速度较慢。
- **半同步通信**：同步异步结合
  - 在统一时钟的基础上，增加一个等待响应信号`WAIT`
- **分离式通信**：充分挖掘系统总线每瞬间的潜力。将总线的传送周期分为两个：
  1. 子周期1：*主模块*申请占用总线，使用完后放弃总线的使用权
  2. 子周期2：*从模块*申请占用总线，将各信息送至总线
